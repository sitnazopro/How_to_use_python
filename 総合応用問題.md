# 総合応用問題

これまでの1章から9章までの知識を組み合わせて、少し複雑なプログラムを作成してみましょう。

---

## 応用問題1：コンソールベースのToDoリスト

これまでに学んだ、変数、リスト、ループ、関数、条件分岐、エラーハンドリングを組み合わせて、シンプルなToDoリストアプリケーションを作成します。

**要件：**
1.  プログラムを実行すると、以下のメニューが表示され続ける。
    -   `1: タスクを追加`
    -   `2: タスクを一覧表示`
    -   `3: タスクを削除`
    -   `4: 終了`
2.  ユーザーが `1` を選ぶと、新しいタスクの入力を求められ、ToDoリストに追加される。
3.  ユーザーが `2` を選ぶと、現在のToDoリストが番号付きで表示される。タスクが1つもなければ「タスクはありません。」と表示する。
4.  ユーザーが `3` を選ぶと、削除したいタスクの番号を尋ねられ、指定されたタスクがリストから削除される。
5.  ユーザーが `4` を選ぶと、「アプリケーションを終了します。」と表示されてプログラムが終わる。
6.  無効なメニュー番号や、タスク削除時に数字以外が入力された場合は、エラーメッセージを表示して処理を継続する。

**ヒント：**
-   タスクの管理にはリストを使います。
-   プログラムのメインループには `while True:` を使います。
-   各機能（追加、表示、削除）をそれぞれ関数として定義すると、コードが整理されて見やすくなります。
-   タスクを削除する際は、ユーザーが入力した番号がリストの有効な範囲内にあるか、また数値として正しいかをチェックする必要があります (`try-except` が役立ちます)。

<details>
<summary>解答例</summary>

```python
def show_tasks(tasks):
    """タスクを番号付きで一覧表示する関数"""
    print("\n--- ToDoリスト ---")
    if not tasks:
        print("タスクはありません。")
    else:
        for i, task in enumerate(tasks):
            print(f"{i + 1}: {task}")
    print("--------------------\n")

def add_task(tasks):
    """新しいタスクを追加する関数"""
    new_task = input("追加するタスクを入力してください: ")
    tasks.append(new_task)
    print(f"「{new_task}」を追加しました。")

def delete_task(tasks):
    """指定された番号のタスクを削除する関数"""
    try:
        show_tasks(tasks)
        if not tasks:
            return # タスクがなければ何もしない
        
        task_num_str = input("削除するタスクの番号を入力してください: ")
        task_num = int(task_num_str)

        if 1 <= task_num <= len(tasks):
            removed_task = tasks.pop(task_num - 1)
            print(f"「{removed_task}」を削除しました。")
        else:
            print("エラー: 無効なタスク番号です。")
    except ValueError:
        print("エラー: 番号を数値で入力してください。")

def main():
    """メインの処理"""
    todo_list = []

    while True:
        print("メニューを選択してください:")
        print("1: タスクを追加")
        print("2: タスクを一覧表示")
        print("3: タスクを削除")
        print("4: 終了")
        
        choice = input("> ")

        if choice == '1':
            add_task(todo_list)
        elif choice == '2':
            show_tasks(todo_list)
        elif choice == '3':
            delete_task(todo_list)
        elif choice == '4':
            print("アプリケーションを終了します。")
            break
        else:
            print("無効な選択です。1から4の数字を入力してください。")

# プログラムの開始
if __name__ == "__main__":
    main()
```
</details>

---

## 応用問題2：連絡先管理プログラム（ファイル保存機能付き）

クラス、辞書、関数、ファイル操作、エラーハンドリングを組み合わせて、連絡先を管理するプログラムを作成します。

**要件：**
1.  連絡先は `Contact` クラスで管理し、`name`（名前）、`phone`（電話番号）、`email`（メールアドレス）の属性を持つ。
2.  プログラム起動時に `contacts.txt` というファイルから連絡先データを読み込む。ファイルがなければ何もしない。
3.  以下のメニューを持つ。
    -   `1: 連絡先を追加`
    -   `2: 連絡先を検索`
    -   `3: 全ての連絡先を表示`
    -   `4: 保存して終了`
4.  連絡先を追加すると、`Contact` オブジェクトが作成され、辞書に保存される（キーは名前にする）。
5.  連絡先を検索すると、名前で検索し、見つかればその人の電話番号とメールアドレスを表示する。
6.  プログラム終了時に、メモリ上の連絡先データを `contacts.txt` に保存する。

**ヒント：**
-   ファイルに保存する形式は自由ですが、一行に一人の連絡先をカンマ区切りで保存する（例: `山田太郎,090-1234-5678,taro@example.com`）と扱いやすいです。
-   起動時にファイルを読み込む際は `try-except FileNotFoundError` を使います。
-   終了時に保存するのを忘れないようにしましょう。

<details>
<summary>解答例</summary>

```python
CONTACTS_FILE = "contacts.txt"

class Contact:
    """連絡先情報を保持するクラス"""
    def __init__(self, name, phone, email):
        self.name = name
        self.phone = phone
        self.email = email

    def __str__(self):
        """オブジェクトを文字列として表現する際の形式"""
        return f"名前: {self.name}, 電話番号: {self.phone}, メール: {self.email}"

def load_contacts():
    """ファイルから連絡先を読み込む"""
    contacts = {}
    try:
        with open(CONTACTS_FILE, "r", encoding="utf-8") as f:
            for line in f:
                # 改行コードを削除し、カンマで分割
                parts = line.strip().split(',')
                if len(parts) == 3:
                    name, phone, email = parts
                    contacts[name] = Contact(name, phone, email)
    except FileNotFoundError:
        # ファイルが存在しない場合は空の辞書を返す
        pass
    return contacts

def save_contacts(contacts):
    """連絡先をファイルに保存する"""
    with open(CONTACTS_FILE, "w", encoding="utf-8") as f:
        for contact in contacts.values():
            f.write(f"{contact.name},{contact.phone},{contact.email}\n")

def main():
    """メインの処理"""
    contacts = load_contacts()
    print("連絡先管理プログラムへようこそ！")

    while True:
        print("\nメニュー:")
        print("1: 連絡先を追加")
        print("2: 連絡先を検索")
        print("3: 全ての連絡先を表示")
        print("4: 保存して終了")
        
        choice = input("> ")

        if choice == '1':
            name = input("名前: ")
            if name in contacts:
                print("エラー: その名前は既に使用されています。")
                continue
            phone = input("電話番号: ")
            email = input("メールアドレス: ")
            contacts[name] = Contact(name, phone, email)
            print("連絡先を追加しました。")

        elif choice == '2':
            name = input("検索する名前: ")
            contact = contacts.get(name)
            if contact:
                print(contact)
            else:
                print("その連絡先は見つかりませんでした。")

        elif choice == '3':
            if not contacts:
                print("連絡先は登録されていません。")
            else:
                for contact in contacts.values():
                    print(contact)

        elif choice == '4':
            save_contacts(contacts)
            print("連絡先を保存しました。プログラムを終了します。")
            break
        else:
            print("無効な選択です。")

if __name__ == "__main__":
    main()
```
</details>